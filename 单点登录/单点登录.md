#### Session ，Cookie， Token

1. Session+Cookie

__由于http协议无状态性，为了让某个域名下的所有网页能够共享某些数据，session和cookie出现了，客户端访问服务器的流程如下：__

+ 首先，客户端发送http请求给客户端。

+ 服务器接收到客户端请求之后，建立一个session，并发送一个http响应到客户端，其中包含set-cookie头部，该头部包含了sessionid。

+ 客户端发起第二次请求，加入服务器给了set-cookie，浏览器会自动在请求头中添加cookie。

+ 服务器接收请求，分解cookie，验证信息，核对成功后返回response给客户端。

  **1. cookie只是实现session的其中的一种解决方案，虽然是最常用的，但并不是唯一的方案，禁用cookie还可以用其他方法存储。**

  **2. 用session只需要在客户端保存一个id<sessionid>，实际上大量数据都保存在服务端，如果全部用cookie，数据量大的时候客户端是没有那么多空间的**

  **3. 如果只用cookie不用session，那么账户信息全部保存在客户端，一旦被劫持，全部信息都会泄露。并且客户端数据量变大，网络传输的数据量也会变大。**

2. token

   __token称作令牌，有uid+time+sign[+固定参数]，认证方式类似于临时的证书签名，是一种服务端无状态的认证方式，意思就是服务端并不会保存身份认证相关的数据__

   ###### token的认证流程

   + 用户登录，成功后服务器返回Token给客户端。
   + 客户端收到数据后保存在客户端。
   + 客户端再次访问服务器，将token放入headers中。
   + 服务端采用filter过滤校验，校验成功则返回请求数据，校验失败则返回错误码。

   __jwt只是一个跨域认证的方案__

#### Session 跨域

__域：应用模型中，一个完整的，有独立访问路径的功能集合称为一个域，如，百度是一个应用或者系统，搜索引擎（www.baidu .com),百度贴吧(tie.baidu.com)都是一个域。域的划分，以IP，端口，域名，主机名进行划分。__

__跨域：客户端请求的时候，请求的服务器不是同一个ip，端口，域名，都成为跨域。__

__Session跨域技术是摒弃了系统自己的session<Tomcat提供的session>，而使用自定义的类似session的机制来保存客户端数据的一种解决方案__

两种解决方案

1. cookie
2. 请求头

##### Spring session共享





#### JWT机制<JSON WEB TOKEN>

+ JWT是一种紧凑且自包含的，用于在多方传递JSON对象的技术。传递的数据可以使用数字签名增加其安全行。可以使用HMAC加密算法或RSA公钥/私钥加密方式。

  + 紧凑：数据小，可以通过URL，POST参数，请求头发送。且数据小代表传输速度快。
  + 自包含：使用payload数据块记录用户必要且不隐私的数据，可以有效的减少数据库访问次数，提高代码性能。

+ JWT一般用于处理用户身份验证或数据信息交换。

  + 用户身份验证：一旦用户登录，每个后续请求都将包含JWT，允许用户访问该令牌允许的路由，服务和资源。单点登录是当今广泛使用JWT的一项功能，因为它的开销很小，并且能够轻松地跨不同域使用。
  + 数据信息交换：JWT是一种非常方便的多方传递数据的载体，因为其可以使用数据签名来保证数据的有效性和安全性

+ JWT数据结构

  ```java
  JWT的数据结构是 ： A.B.C。 由字符点‘.’来分隔三部分数据。
  A - header 头信息
  B - payload （有效荷载？）
  C - Signature 签名
  
  -- header
  数据结构： {“alg”: “加密算法名称”, “typ” : “JWT”}
  alg是加密算法定义内容，如：HMAC SHA256 或 RSA
  typ是token类型，这里固定为JWT。
  -- payload
  在payload数据块中一般用于记录实体（通常为用户信息）或其他数据的。主要分为三个部分，分别是：已注册信息（registered claims），公开数据（public claims），私有数据（private claims）。
  payload中常用信息有：iss（发行者），exp（到期时间），sub（主题），aud（受众）等。前面列举的都是已注册信息。
  公开数据部分一般都会在JWT注册表中增加定义。避免和已注册信息冲突。
  公开数据和私有数据可以由程序员任意定义。
  即使JWT有签名加密机制，但是payload内容都是明文记录，除非记录的是加密数据，否则不排除泄露隐私数据的可能。不推荐在payload中记录任何敏感数据。
  -- Signature
  签名信息。这是一个由开发者提供的信息。是服务器验证的传递的数据是否有效安全的标准。在生成JWT最终数据的之前。先使用header中定义的加密算法，将header和payload进行加密，并使用点进行连接。如：加密后的head.加密后的payload。再使用相同的加密算法，对加密后的数据和签名信息进行加密。得到最终结果。
  ```

  

  #### 基于JWT机制的单点登录

  1. 注意：使用JWT实现单点登录，需要注意token失效性。token是保存在客户端的令牌数据，如果永久有效，则有被劫持的可能，token在设计的时候，可以考虑一次性有效或一段时间内有效，如果设置有效时长，则需要重新考虑是否需要刷新token有效期问题。
  2. token保存位置
     + 使用JWT技术生成的token，客户端在保存的时候可以考虑cookie和localStorage，cookie保存方式，可以实现跨域传递数据。localStorage是域私有的本地存储，无法实现跨域。
  3. webStorage
     + webstorage可保存的数据容量为5M。且只能存储字符串数据。
     + webstorage分为localStorage和sessionStorage。
     + localStorage的生命周期是永久的，关闭页面或浏览器之后localStorage中的数据也不会消失。localStorage除非主动删除数据，否则数据永远不会消失。
     + sessionStorage是会话相关的本地存储单元，生命周期是在仅在当前会话下有效。引入了一个浏览器窗口的概念，是在同源的窗口中始终存在的数据。只要这个浏览器窗口没有关闭，即使刷新页面或者进入同源另一个页面，数据依然存在。但是在关闭了浏览器窗口后就会被销毁。同时独立的打开同一个窗口同一个页面，也是不一样的。

  

  





